<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°ì„± ì¼ê¸° - AI ê¸°ë°˜ ê°ì • ë¶„ì„ ì¼ê¸°</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script src="https://cdn.jsdelivr.net/npm/d3-cloud@1.2.5/build/d3.layout.cloud.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans KR', sans-serif;
            /* Unsplash ìì—° ë°°ê²½ ì´ë¯¸ì§€ ì‚¬ìš© */
            background: linear-gradient(rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)), url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
            
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* í—¤ë” */
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 700;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        /* ë©”ì¸ ì¹´ë“œ */
        .main-card {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            margin-bottom: 30px;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ */
        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #e9ecef;
        }

        .nav-tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            background: none;
            font-size: 1rem;
            font-weight: 500;
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        /* íƒ­ ì»¨í…ì¸  */
        .tab-content {
            display: none;
            padding: 40px;
        }

        .tab-content.active {
            display: block;
        }

        /* íŒŒì¼ ì—…ë¡œë“œ */
        .upload-section {
            text-align: center;
            padding: 40px 20px;
        }

        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 15px;
            padding: 60px 20px;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9ff;
        }

        .upload-area:hover {
            border-color: #764ba2;
            background: #f0f2ff;
        }

        .upload-area.dragover {
            border-color: #764ba2;
            background: #e8ecff;
        }

        .upload-icon {
            font-size: 3rem;
            color: #667eea;
            margin-bottom: 20px;
        }

        .upload-text {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 10px;
        }

        .upload-hint {
            font-size: 0.9rem;
            color: #999;
        }

        #fileInput {
            display: none;
        }

        /* ë²„íŠ¼ */
        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        /* ë¡œë”© */
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ì¼ê¸° ëª©ë¡ */
        .diary-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .diary-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
        }

        .diary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .diary-date {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 10px;
        }

        .diary-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }

        .diary-summary {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* ê°ì • ì°¨íŠ¸ */
        .emotion-chart {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .emotion-bar {
            flex: 1;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .emotion-fill {
            height: 8px;
            transition: width 0.3s ease;
        }

        .emotion-good { background: #28a745; }
        .emotion-normal { background: #ffc107; }
        .emotion-bad { background: #dc3545; }

        .emotion-label {
            font-size: 0.8rem;
            text-align: center;
            margin-top: 5px;
            color: #666;
        }

        /* í†µê³„ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 10px;
        }

        .stat-label {
            color: #666;
            font-size: 1rem;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            position: relative;
        }

        .close {
            position: absolute;
            right: 20px;
            top: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #aaa;
        }

        .close:hover {
            color: #333;
        }

        /* ì•Œë¦¼ */
        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .nav-tabs {
                flex-direction: column;
            }
            
            .tab-content {
                padding: 20px;
            }
            
            .diary-list {
                grid-template-columns: 1fr;
            }
        }

        /* ë¹„ë°€ë²ˆí˜¸ í™”ë©´ */
        .password-screen {
            display: none;
            text-align: center;
            padding: 60px 20px;
        }

        .password-form {
            max-width: 400px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-control {
            width: 100%;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
        }

        /* íŠœí† ë¦¬ì–¼ */
        .tutorial-screen {
            display: none;
            text-align: center;
            padding: 40px 20px;
        }

        .tutorial-step {
            display: none;
            margin-bottom: 30px;
        }

        .tutorial-step.active {
            display: block;
        }

        .tutorial-image {
            max-width: 300px;
            height: 200px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px auto;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        .tutorial-nav {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
        }

        /* ì¼ê¸° ìƒì„± ê²°ê³¼ */
        .diary-result {
            margin-top: 30px;
            text-align: left;
        }

        .result-card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-left: 4px solid #667eea;
        }

        .result-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 10px;
        }

        .result-date {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 20px;
        }

        .result-summary {
            color: #555;
            line-height: 1.8;
            margin-bottom: 25px;
            font-size: 1.1rem;
        }

        .result-emotions {
            margin-bottom: 25px;
        }

        .result-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }

        /* ì¼ê¸° ì¹´ë“œ ê°œì„  */
        .diary-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            border-left: 4px solid #667eea;
            cursor: pointer;
        }

        .diary-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.15);
        }

        .diary-summary {
            color: #666;
            line-height: 1.6;
            margin-bottom: 20px;
            cursor: pointer;
            position: relative;
        }

        .diary-summary.expanded {
            max-height: none;
        }

        .diary-summary.collapsed {
            max-height: 80px;
            overflow: hidden;
            position: relative;
        }

        .diary-summary.collapsed::after {
            content: '... ë”ë³´ê¸°';
            position: absolute;
            bottom: 0;
            right: 0;
            background: white;
            color: #667eea;
            font-weight: 500;
            cursor: pointer;
            padding-left: 10px;
        }

        .diary-summary.expanded::after {
            content: 'ì ‘ê¸°';
            position: absolute;
            bottom: 0;
            right: 0;
            background: white;
            color: #667eea;
            font-weight: 500;
            cursor: pointer;
            padding-left: 10px;
        }

        /* ë°°ê²½ ì„¤ì • */
        .settings-section {
            margin-top: 40px;
            padding: 30px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }

        .background-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .bg-option {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .bg-option:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .bg-option.active {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .bg-preview {
            width: 80px;
            height: 60px;
            border-radius: 8px;
            margin-bottom: 10px;
            background-size: cover;
            background-position: center;
        }

        .gradient-preview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .nature-preview {
            background: linear-gradient(rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8)), url('https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
        }

        .forest-preview {
            background: linear-gradient(rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8)), url('https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=2071&q=80');
        }

        .ocean-preview {
            background: linear-gradient(rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8)), url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-4.0.3&auto=format&fit=crop&w=2073&q=80');
        }

        .mountain-preview {
            background: linear-gradient(rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8)), url('https://images.unsplash.com/photo-1464822759844-d150baec0134?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80');
        }

        .abstract-preview {
            background: linear-gradient(rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.8)), url('https://images.unsplash.com/photo-1557683316-973673baf926?ixlib=rb-4.0.3&auto=format&fit=crop&w=2029&q=80');
        }

        .custom-preview {
            background: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #667eea;
            font-size: 1.5rem;
        }

        /* í‚¤ì›Œë“œ í´ë¼ìš°ë“œ */
        .keyword-cloud-container {
            width: 100%;
            height: 400px;
            background: white;
            border-radius: 15px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #e9ecef;
            position: relative;
        }

        .keyword-cloud-container svg {
            width: 100%;
            height: 100%;
        }

        .cloud-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .keyword-word {
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .keyword-word:hover {
            fill: #667eea !important;
            transform: scale(1.1);
        }

        .cloud-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            color: #666;
        }

        .cloud-loading .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1><i class="fas fa-book-open"></i> ê°ì„± ì¼ê¸°</h1>
            <p>AIê°€ ë¶„ì„í•˜ëŠ” ë‹¹ì‹ ì˜ ê°ì • ì´ì•¼ê¸°</p>
        </div>

        <!-- ë¹„ë°€ë²ˆí˜¸ í™”ë©´ -->
        <div class="password-screen" id="passwordScreen">
            <div class="main-card">
                <div class="password-form">
                    <h2 id="passwordTitle">ë¹„ë°€ë²ˆí˜¸ ì„¤ì •</h2>
                    <p id="passwordSubtitle">ì¼ê¸°ë¥¼ ì•ˆì „í•˜ê²Œ ë³´í˜¸í•˜ê¸° ìœ„í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.</p>
                    
                    <div class="form-group">
                        <input type="password" id="passwordInput" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”" onkeypress="handleKeyPress(event)">
                    </div>
                    
                    <div class="form-group">
                        <input type="password" id="confirmPasswordInput" class="form-control" placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ë‹¤ì‹œ ì…ë ¥í•˜ì„¸ìš”" onkeypress="handleKeyPress(event)" style="display: none;">
                    </div>
                    
                    <button class="btn btn-primary" onclick="handlePassword()">í™•ì¸</button>
                </div>
            </div>
        </div>

        <!-- íŠœí† ë¦¬ì–¼ í™”ë©´ -->
        <div class="tutorial-screen" id="tutorialScreen">
            <div class="main-card">
                <div class="tutorial-step active" data-step="1">
                    <h2>í™˜ì˜í•©ë‹ˆë‹¤! ğŸ‘‹</h2>
                    <p>ê°ì„± ì¼ê¸° ì•±ì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì„ ì•ˆë‚´í•´ë“œë¦´ê²Œìš”.</p>
                    <div class="tutorial-image">
                        <i class="fas fa-heart" style="font-size: 3rem; color: #667eea;"></i>
                    </div>
                </div>
                
                <div class="tutorial-step" data-step="2">
                    <h2>ì¹´ì¹´ì˜¤í†¡ ëŒ€í™” ë‚´ë³´ë‚´ê¸° ğŸ“±</h2>
                    <p>ì¹´ì¹´ì˜¤í†¡ì—ì„œ ëŒ€í™”ë°©ì„ ì„ íƒí•˜ê³  'ëŒ€í™”ë‚´ìš© ë‚´ë³´ë‚´ê¸°'ë¥¼ í†µí•´ txt íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.</p>
                    <div class="tutorial-image">
                        <i class="fas fa-file-upload" style="font-size: 3rem; color: #667eea;"></i>
                    </div>
                </div>
                
                <div class="tutorial-step" data-step="3">
                    <h2>íŒŒì¼ ì—…ë¡œë“œ ğŸ“</h2>
                    <p>ë‚´ë³´ë‚¸ txt íŒŒì¼ì„ ì—¬ê¸°ì— ì—…ë¡œë“œí•˜ë©´ AIê°€ ìë™ìœ¼ë¡œ ê°ì •ì„ ë¶„ì„í•˜ê³  ì¼ê¸°ë¥¼ ìƒì„±í•´ë“œë¦½ë‹ˆë‹¤.</p>
                    <div class="tutorial-image">
                        <i class="fas fa-robot" style="font-size: 3rem; color: #667eea;"></i>
                    </div>
                </div>
                
                <div class="tutorial-step" data-step="4">
                    <h2>ê°ì • ë¶„ì„ ğŸ“Š</h2>
                    <p>AIê°€ ëŒ€í™” ë‚´ìš©ì„ ë¶„ì„í•˜ì—¬ ë‹¹ì‹ ì˜ ê°ì • ìƒíƒœë¥¼ ì‹œê°í™”í•˜ê³  ì¼ê¸°ë¡œ ì •ë¦¬í•´ë“œë¦½ë‹ˆë‹¤.</p>
                    <div class="tutorial-image">
                        <i class="fas fa-chart-pie" style="font-size: 3rem; color: #667eea;"></i>
                    </div>
                </div>
                
                <div class="tutorial-nav">
                    <button class="btn btn-secondary" onclick="prevTutorialStep()">ì´ì „</button>
                    <button class="btn btn-primary" onclick="nextTutorialStep()">ë‹¤ìŒ</button>
                </div>
            </div>
        </div>

        <!-- ë©”ì¸ ì•± -->
        <div id="mainApp" style="display: none;">
            <!-- ë„¤ë¹„ê²Œì´ì…˜ íƒ­ -->
            <div class="main-card">
                <div class="nav-tabs">
                    <button class="nav-tab active" onclick="showTab('upload')">
                        <i class="fas fa-upload"></i> ì¼ê¸° ìƒì„±
                    </button>
                    <button class="nav-tab" onclick="showTab('diaries')">
                        <i class="fas fa-book"></i> ì¼ê¸° ëª©ë¡
                    </button>
                    <button class="nav-tab" onclick="showTab('stats')">
                        <i class="fas fa-chart-bar"></i> í†µê³„
                    </button>
                </div>

                <!-- íŒŒì¼ ì—…ë¡œë“œ íƒ­ -->
                <div id="uploadTab" class="tab-content active">
                    <div class="upload-section">
                        <h2>ì¹´ì¹´ì˜¤í†¡ ëŒ€í™”ë¡œ ì¼ê¸° ìƒì„±í•˜ê¸°</h2>
                        <p>ì¹´ì¹´ì˜¤í†¡ì—ì„œ ë‚´ë³´ë‚¸ txt íŒŒì¼ì„ ì—…ë¡œë“œí•˜ë©´ AIê°€ ìë™ìœ¼ë¡œ ê°ì •ì„ ë¶„ì„í•˜ê³  ì¼ê¸°ë¥¼ ìƒì„±í•´ë“œë¦½ë‹ˆë‹¤.</p>
                        
                        <div class="upload-area" id="uploadArea" onclick="document.getElementById('fileInput').click()">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div class="upload-text">íŒŒì¼ì„ í´ë¦­í•˜ê±°ë‚˜ ë“œë˜ê·¸í•˜ì—¬ ì—…ë¡œë“œí•˜ì„¸ìš”</div>
                            <div class="upload-hint">ì§€ì› í˜•ì‹: .txt (ì¹´ì¹´ì˜¤í†¡ ë‚´ë³´ë‚´ê¸° íŒŒì¼)</div>
                        </div>
                        
                        <input type="file" id="fileInput" accept=".txt" onchange="handleFileSelect(event)">
                        
                        <div class="loading" id="loading">
                            <div class="spinner"></div>
                            <p>AIê°€ ì¼ê¸°ë¥¼ ìƒì„±í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                        </div>
                        
                        <!-- ì¼ê¸° ìƒì„± ê²°ê³¼ í‘œì‹œ ì˜ì—­ -->
                        <div id="diaryResult" class="diary-result" style="display: none;">
                            <h3>ìƒì„±ëœ ì¼ê¸°</h3>
                            <div class="result-card">
                                <div class="result-title" id="resultTitle"></div>
                                <div class="result-date" id="resultDate"></div>
                                <div class="result-summary" id="resultSummary"></div>
                                <div class="result-emotions" id="resultEmotions"></div>
                                <div class="result-actions">
                                    <button class="btn btn-primary" onclick="saveAndShowList()">
                                        <i class="fas fa-save"></i> ì¼ê¸° ì €ì¥
                                    </button>
                                    <button class="btn btn-secondary" onclick="generateNewDiary()">
                                        <i class="fas fa-plus"></i> ìƒˆ ì¼ê¸° ìƒì„±
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="alert alert-success" id="successAlert"></div>
                        <div class="alert alert-error" id="errorAlert"></div>
                    </div>
                </div>

                <!-- ì¼ê¸° ëª©ë¡ íƒ­ -->
                <div id="diariesTab" class="tab-content">
                    <h2>ë‚˜ì˜ ì¼ê¸° ëª©ë¡</h2>
                    <div class="diary-list" id="diaryList">
                        <!-- ì¼ê¸° ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </div>
                </div>

                <!-- í†µê³„ íƒ­ -->
                <div id="statsTab" class="tab-content">
                    <h2>ê°ì • í†µê³„</h2>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number" id="totalDiaries">0</div>
                            <div class="stat-label">ì´ ì¼ê¸° ìˆ˜</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avgGood">0%</div>
                            <div class="stat-label">í‰ê·  ê¸ì •ë„</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avgNormal">0%</div>
                            <div class="stat-label">í‰ê·  ì¤‘ë¦½ë„</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="avgBad">0%</div>
                            <div class="stat-label">í‰ê·  ë¶€ì •ë„</div>
                        </div>
                    </div>
                    
                    <!-- í‚¤ì›Œë“œ í´ë¼ìš°ë“œ -->
                    <div class="settings-section">
                        <h3>í‚¤ì›Œë“œ í´ë¼ìš°ë“œ</h3>
                        <p>ì¼ê¸°ì—ì„œ ìì£¼ ë“±ì¥í•˜ëŠ” ë‹¨ì–´ë“¤ì„ ì‹œê°í™”í•©ë‹ˆë‹¤.</p>
                        <div id="keywordCloud" class="keyword-cloud-container"></div>
                        <div class="cloud-controls">
                            <button class="btn btn-primary" onclick="generateKeywordCloud()">
                                <i class="fas fa-cloud"></i> í‚¤ì›Œë“œ ë¶„ì„
                            </button>
                            <button class="btn btn-secondary" onclick="clearKeywordCloud()">
                                <i class="fas fa-trash"></i> ì´ˆê¸°í™”
                            </button>
                        </div>
                    </div>

                    <!-- ë°°ê²½ ì„¤ì • -->
                    <div class="settings-section">
                        <h3>ë°°ê²½ ì„¤ì •</h3>
                        <div class="background-options">
                            <button class="bg-option" onclick="changeBackground('gradient')">
                                <div class="bg-preview gradient-preview"></div>
                                <span>ê¸°ë³¸ ê·¸ë¼ë°ì´ì…˜</span>
                            </button>
                            <button class="bg-option active" onclick="changeBackground('nature')">
                                <div class="bg-preview nature-preview"></div>
                                <span>ìì—° í’ê²½</span>
                            </button>
                            <button class="bg-option" onclick="changeBackground('forest')">
                                <div class="bg-preview forest-preview"></div>
                                <span>ìˆ²</span>
                            </button>
                            <button class="bg-option" onclick="changeBackground('ocean')">
                                <div class="bg-preview ocean-preview"></div>
                                <span>ë°”ë‹¤</span>
                            </button>
                            <button class="bg-option" onclick="changeBackground('mountain')">
                                <div class="bg-preview mountain-preview"></div>
                                <span>ì‚°</span>
                            </button>
                            <button class="bg-option" onclick="changeBackground('abstract')">
                                <div class="bg-preview abstract-preview"></div>
                                <span>ì¶”ìƒì </span>
                            </button>
                            <button class="bg-option" onclick="changeBackground('custom')">
                                <div class="bg-preview custom-preview">
                                    <i class="fas fa-upload"></i>
                                </div>
                                <span>ì»¤ìŠ¤í…€ ì´ë¯¸ì§€</span>
                                <input type="file" id="customBgInput" accept="image/*" onchange="uploadCustomBackground(event)" style="display: none;">
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ì¼ê¸° ìƒì„¸ ëª¨ë‹¬ -->
    <div id="diaryModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2 id="modalTitle"></h2>
            <p id="modalDate"></p>
            <div id="modalSummary"></div>
            <div id="modalEmotions"></div>
        </div>
    </div>

    <script>
        // ì „ì—­ ë³€ìˆ˜
        let diaries = [];
        let currentTutorialStep = 1;
        let isPasswordSet = false;
        let storedPassword = '';
        let currentGeneratedDiary = null;



        // ë¹„ë°€ë²ˆí˜¸ ìƒíƒœ í™•ì¸
        function checkPasswordStatus() {
            storedPassword = localStorage.getItem('user_password') || '';
            isPasswordSet = storedPassword.length > 0;
            
            if (!isPasswordSet) {
                showPasswordScreen();
            } else {
                showMainApp();
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ í™”ë©´ í‘œì‹œ
        function showPasswordScreen() {
            document.getElementById('passwordScreen').style.display = 'block';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('tutorialScreen').style.display = 'none';
            
            if (!isPasswordSet) {
                document.getElementById('passwordTitle').textContent = 'ë¹„ë°€ë²ˆí˜¸ ì„¤ì •';
                document.getElementById('passwordSubtitle').textContent = 'ì¼ê¸°ë¥¼ ì•ˆì „í•˜ê²Œ ë³´í˜¸í•˜ê¸° ìœ„í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.';
                document.getElementById('confirmPasswordInput').style.display = 'block';
            } else {
                document.getElementById('passwordTitle').textContent = 'ë¹„ë°€ë²ˆí˜¸ í™•ì¸';
                document.getElementById('passwordSubtitle').textContent = 'ì¼ê¸°ì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.';
                document.getElementById('confirmPasswordInput').style.display = 'none';
            }
        }

        // ë¹„ë°€ë²ˆí˜¸ ì²˜ë¦¬
        function handlePassword() {
            const password = document.getElementById('passwordInput').value;
            const confirmPassword = document.getElementById('confirmPasswordInput').value;
            
            if (!isPasswordSet) {
                // ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ëª¨ë“œ
                if (password.length < 4) {
                    showAlert('ë¹„ë°€ë²ˆí˜¸ëŠ” ìµœì†Œ 4ì ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.', 'error');
                    return;
                }
                
                if (confirmPassword !== password) {
                    showAlert('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                    return;
                }
                
                localStorage.setItem('user_password', password);
                storedPassword = password;
                isPasswordSet = true;
                showAlert('ë¹„ë°€ë²ˆí˜¸ê°€ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
                setTimeout(() => {
                    showTutorialScreen();
                }, 1000);
            } else {
                // ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ëª¨ë“œ
                if (password === storedPassword) {
                    showMainApp();
                } else {
                    showAlert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                }
            }
        }

        // íŠœí† ë¦¬ì–¼ í™”ë©´ í‘œì‹œ
        function showTutorialScreen() {
            document.getElementById('passwordScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'none';
            document.getElementById('tutorialScreen').style.display = 'block';
            
            // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('passwordInput').value = '';
            document.getElementById('confirmPasswordInput').value = '';
        }

        // ë©”ì¸ ì•± í‘œì‹œ
        function showMainApp() {
            document.getElementById('passwordScreen').style.display = 'none';
            document.getElementById('tutorialScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            
            // ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
            document.getElementById('passwordInput').value = '';
        }

        // íŠœí† ë¦¬ì–¼ ë„¤ë¹„ê²Œì´ì…˜
        function nextTutorialStep() {
            if (currentTutorialStep < 4) {
                currentTutorialStep++;
                updateTutorialStep();
            } else {
                showMainApp();
            }
        }

        function prevTutorialStep() {
            if (currentTutorialStep > 1) {
                currentTutorialStep--;
                updateTutorialStep();
            }
        }

        function updateTutorialStep() {
            document.querySelectorAll('.tutorial-step').forEach(step => {
                step.classList.remove('active');
            });
            document.querySelector(`[data-step="${currentTutorialStep}"]`).classList.add('active');
        }

        // íƒ­ ì „í™˜
        function showTab(tabName) {
            // ëª¨ë“  íƒ­ ë¹„í™œì„±í™”
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // ì„ íƒëœ íƒ­ í™œì„±í™”
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
            
            // ì¼ê¸° ìƒì„± íƒ­ì´ ì•„ë‹Œ ê²½ìš° ê²°ê³¼ ìˆ¨ê¹€
            if (tabName !== 'upload') {
                hideDiaryResult();
            }
            
            // í†µê³„ íƒ­ì¸ ê²½ìš° í†µê³„ ì—…ë°ì´íŠ¸
            if (tabName === 'stats') {
                updateStats();
            }
        }

        // íŒŒì¼ ì„ íƒ ì²˜ë¦¬
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                uploadFile(file);
            }
        }

        // íŒŒì¼ ì—…ë¡œë“œ
        async function uploadFile(file) {
            if (!file.name.endsWith('.txt')) {
                showAlert('txt íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            showLoading(true);
            hideAlerts();
            hideDiaryResult();

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('http://localhost:8000/auto-diary', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    const result = await response.json();
                    currentGeneratedDiary = result;
                    showDiaryResult(result);
                    
                    // í‚¤ì›Œë“œê°€ ìˆìœ¼ë©´ í´ë¼ìš°ë“œì— ì¶”ê°€
                    if (result.keywords && result.keywords.length > 0) {
                        addKeywordsToCloud(result.keywords);
                    }
                    
                    showAlert('ì¼ê¸°ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
                } else {
                    const errorData = await response.json();
                    showAlert(`ì˜¤ë¥˜: ${errorData.detail || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.'}`, 'error');
                }
            } catch (error) {
                showAlert('ì„œë²„ ì—°ê²°ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.', 'error');
            } finally {
                showLoading(false);
            }
        }

        // ì¼ê¸° ê²°ê³¼ í‘œì‹œ
        function showDiaryResult(diaryData) {
            const resultDiv = document.getElementById('diaryResult');
            const emotions = diaryData.emotions || { 'ì¢‹ìŒ': 33, 'í‰ë²”í•¨': 34, 'ë‚˜ì¨': 33 };

            // ì¼ê¸° ì œëª© ìƒì„±
            const title = diaryData.title || 'ìƒˆë¡œìš´ ì¼ê¸°';
            document.getElementById('resultTitle').textContent = title;
            document.getElementById('resultDate').textContent = new Date().toLocaleDateString('ko-KR');
            
            // ì¼ê¸° ë‚´ìš© êµ¬ì„± (5ê°œ ì„¹ì…˜ì„ í•˜ë‚˜ë¡œ í•©ì¹˜ê¸°)
            let fullContent = '';
            if (diaryData.summary) {
                fullContent += `<h4>ğŸ“ ìš”ì•½</h4><p>${diaryData.summary}</p><br>`;
            }
            if (diaryData['ìƒí™©ì„¤ëª…']) {
                fullContent += `<h4>ğŸ“‹ ìƒí™© ì„¤ëª…</h4><p>${diaryData['ìƒí™©ì„¤ëª…']}</p><br>`;
            }
            if (diaryData['ê°ì •í‘œí˜„']) {
                fullContent += `<h4>ğŸ’­ ê°ì • í‘œí˜„</h4><p>${diaryData['ê°ì •í‘œí˜„']}</p><br>`;
            }
            if (diaryData['ê³µê°ê³¼ì¸ì •']) {
                fullContent += `<h4>ğŸ¤— ê³µê°ê³¼ ì¸ì •</h4><p>${diaryData['ê³µê°ê³¼ì¸ì •']}</p><br>`;
            }
            if (diaryData['ë”°ëœ»í•œìœ„ë¡œ']) {
                fullContent += `<h4>ğŸ’• ë”°ëœ»í•œ ìœ„ë¡œ</h4><p>${diaryData['ë”°ëœ»í•œìœ„ë¡œ']}</p><br>`;
            }
            if (diaryData['ì‹¤ìš©ì ì œì•ˆ']) {
                fullContent += `<h4>ğŸ’¡ ì‹¤ìš©ì  ì œì•ˆ</h4><p>${diaryData['ì‹¤ìš©ì ì œì•ˆ']}</p><br>`;
            }
            
            // ë‚´ìš©ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€
            if (!fullContent) {
                fullContent = '<p>ì¼ê¸° ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p>';
            }
            
            document.getElementById('resultSummary').innerHTML = fullContent;
            
            document.getElementById('resultEmotions').innerHTML = `
                <h4>ğŸ“Š ê°ì • ë¶„ì„</h4>
                <div class="emotion-chart">
                    <div class="emotion-bar">
                        <div class="emotion-fill emotion-good" style="width: ${emotions['ì¢‹ìŒ']}%"></div>
                        <div class="emotion-label">ì¢‹ìŒ ${emotions['ì¢‹ìŒ']}%</div>
                    </div>
                    <div class="emotion-bar">
                        <div class="emotion-fill emotion-normal" style="width: ${emotions['í‰ë²”í•¨']}%"></div>
                        <div class="emotion-label">í‰ë²”í•¨ ${emotions['í‰ë²”í•¨']}%</div>
                    </div>
                    <div class="emotion-bar">
                        <div class="emotion-fill emotion-bad" style="width: ${emotions['ë‚˜ì¨']}%"></div>
                        <div class="emotion-label">ë‚˜ì¨ ${emotions['ë‚˜ì¨']}%</div>
                    </div>
                </div>
            `;

            resultDiv.style.display = 'block';
            
            // ê²°ê³¼ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤
            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // ì¼ê¸° ê²°ê³¼ ìˆ¨ê¹€
        function hideDiaryResult() {
            document.getElementById('diaryResult').style.display = 'none';
        }

        // ì¼ê¸° ì €ì¥ ë° ëª©ë¡ í‘œì‹œ
        function saveAndShowList() {
            if (currentGeneratedDiary) {
                addDiary(currentGeneratedDiary);
                showTab('diaries');
                hideDiaryResult();
                showAlert('ì¼ê¸°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!', 'success');
            }
        }

        // ìƒˆ ì¼ê¸° ìƒì„±
        function generateNewDiary() {
            hideDiaryResult();
            document.getElementById('fileInput').value = '';
            currentGeneratedDiary = null;
            showAlert('ìƒˆë¡œìš´ ì¼ê¸°ë¥¼ ìƒì„±í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
        }

        // ì¼ê¸° ì¶”ê°€
        function addDiary(diaryData) {
            // ì¼ê¸° ë‚´ìš© êµ¬ì„± (5ê°œ ì„¹ì…˜ì„ í•˜ë‚˜ë¡œ í•©ì¹˜ê¸°)
            let fullContent = '';
            if (diaryData.summary) {
                fullContent += `ğŸ“ ìš”ì•½: ${diaryData.summary}\n\n`;
            }
            if (diaryData['ìƒí™©ì„¤ëª…']) {
                fullContent += `ğŸ“‹ ìƒí™© ì„¤ëª…: ${diaryData['ìƒí™©ì„¤ëª…']}\n\n`;
            }
            if (diaryData['ê°ì •í‘œí˜„']) {
                fullContent += `ğŸ’­ ê°ì • í‘œí˜„: ${diaryData['ê°ì •í‘œí˜„']}\n\n`;
            }
            if (diaryData['ê³µê°ê³¼ì¸ì •']) {
                fullContent += `ğŸ¤— ê³µê°ê³¼ ì¸ì •: ${diaryData['ê³µê°ê³¼ì¸ì •']}\n\n`;
            }
            if (diaryData['ë”°ëœ»í•œìœ„ë¡œ']) {
                fullContent += `ğŸ’• ë”°ëœ»í•œ ìœ„ë¡œ: ${diaryData['ë”°ëœ»í•œìœ„ë¡œ']}\n\n`;
            }
            if (diaryData['ì‹¤ìš©ì ì œì•ˆ']) {
                fullContent += `ğŸ’¡ ì‹¤ìš©ì  ì œì•ˆ: ${diaryData['ì‹¤ìš©ì ì œì•ˆ']}\n\n`;
            }
            
            // ë‚´ìš©ì´ ì—†ìœ¼ë©´ ê¸°ë³¸ ë©”ì‹œì§€
            if (!fullContent) {
                fullContent = 'ì¼ê¸° ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.';
            }

            const diary = {
                id: Date.now(),
                date: new Date(),
                title: diaryData.title || 'ìƒˆë¡œìš´ ì¼ê¸°',
                summary: fullContent.trim(),
                emotions: diaryData.emotions || { 'ì¢‹ìŒ': 33, 'í‰ë²”í•¨': 34, 'ë‚˜ì¨': 33 }
            };

            diaries.unshift(diary);
            saveDiaries();
            renderDiaries();
        }

        // ì¼ê¸° ì €ì¥
        function saveDiaries() {
            localStorage.setItem('diaries', JSON.stringify(diaries));
        }

        // ì¼ê¸° ë¡œë“œ
        function loadDiaries() {
            const saved = localStorage.getItem('diaries');
            if (saved) {
                diaries = JSON.parse(saved);
                diaries.forEach(diary => {
                    diary.date = new Date(diary.date);
                });
            } else {
                // ë”ë¯¸ ë°ì´í„°
                diaries = [
                    {
                        id: 1,
                        date: new Date(Date.now() - 86400000),
                        title: 'ì–´ì œì˜ ì¼ê¸°',
                        summary: 'ì˜¤ëŠ˜ì€ ì •ë§ ì¢‹ì€ í•˜ë£¨ì˜€ìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ê²ƒì„ ë°°ìš°ê³  ì„±ì¥í•˜ëŠ” ëŠë‚Œì´ ë“¤ì—ˆì–´ìš”.',
                        emotions: { 'ì¢‹ìŒ': 70, 'í‰ë²”í•¨': 20, 'ë‚˜ì¨': 10 }
                    },
                    {
                        id: 2,
                        date: new Date(Date.now() - 172800000),
                        title: '2ì¼ ì „ì˜ ì¼ê¸°',
                        summary: 'í‰ë²”í•œ í•˜ë£¨ì˜€ì§€ë§Œ, ì‘ì€ ê¸°ì¨ë“¤ì„ ë°œê²¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.',
                        emotions: { 'ì¢‹ìŒ': 30, 'í‰ë²”í•¨': 60, 'ë‚˜ì¨': 10 }
                    }
                ];
                saveDiaries();
            }
            renderDiaries();
        }

        // ì¼ê¸° ë Œë”ë§
        function renderDiaries() {
            const diaryList = document.getElementById('diaryList');
            diaryList.innerHTML = '';

            diaries.forEach(diary => {
                const diaryCard = document.createElement('div');
                diaryCard.className = 'diary-card';

                const dateStr = diary.date.toLocaleDateString('ko-KR');
                const emotions = diary.emotions;
                const summaryId = `summary-${diary.id}`;

                diaryCard.innerHTML = `
                    <div class="diary-date">${dateStr}</div>
                    <div class="diary-title">${diary.title}</div>
                    <div class="diary-summary collapsed" id="${summaryId}" onclick="toggleSummary('${summaryId}')">
                        ${diary.summary}
                    </div>
                    <div class="emotion-chart">
                        <div class="emotion-bar">
                            <div class="emotion-fill emotion-good" style="width: ${emotions['ì¢‹ìŒ']}%"></div>
                            <div class="emotion-label">ì¢‹ìŒ ${emotions['ì¢‹ìŒ']}%</div>
                        </div>
                        <div class="emotion-bar">
                            <div class="emotion-fill emotion-normal" style="width: ${emotions['í‰ë²”í•¨']}%"></div>
                            <div class="emotion-label">í‰ë²”í•¨ ${emotions['í‰ë²”í•¨']}%</div>
                        </div>
                        <div class="emotion-bar">
                            <div class="emotion-fill emotion-bad" style="width: ${emotions['ë‚˜ì¨']}%"></div>
                            <div class="emotion-label">ë‚˜ì¨ ${emotions['ë‚˜ì¨']}%</div>
                        </div>
                    </div>
                `;

                diaryList.appendChild(diaryCard);
            });
        }

        // ìš”ì•½ í† ê¸€ í•¨ìˆ˜
        function toggleSummary(summaryId) {
            const summaryElement = document.getElementById(summaryId);
            if (summaryElement.classList.contains('collapsed')) {
                summaryElement.classList.remove('collapsed');
                summaryElement.classList.add('expanded');
            } else {
                summaryElement.classList.remove('expanded');
                summaryElement.classList.add('collapsed');
            }
        }

        // ì¼ê¸° ëª¨ë‹¬ í‘œì‹œ
        function showDiaryModal(diary) {
            const modal = document.getElementById('diaryModal');
            const emotions = diary.emotions;

            document.getElementById('modalTitle').textContent = diary.title;
            document.getElementById('modalDate').textContent = diary.date.toLocaleDateString('ko-KR');
            document.getElementById('modalSummary').textContent = diary.summary;
            
            document.getElementById('modalEmotions').innerHTML = `
                <h3>ê°ì • ë¶„ì„</h3>
                <div class="emotion-chart">
                    <div class="emotion-bar">
                        <div class="emotion-fill emotion-good" style="width: ${emotions['ì¢‹ìŒ']}%"></div>
                        <div class="emotion-label">ì¢‹ìŒ ${emotions['ì¢‹ìŒ']}%</div>
                    </div>
                    <div class="emotion-bar">
                        <div class="emotion-fill emotion-normal" style="width: ${emotions['í‰ë²”í•¨']}%"></div>
                        <div class="emotion-label">í‰ë²”í•¨ ${emotions['í‰ë²”í•¨']}%</div>
                    </div>
                    <div class="emotion-bar">
                        <div class="emotion-fill emotion-bad" style="width: ${emotions['ë‚˜ì¨']}%"></div>
                        <div class="emotion-label">ë‚˜ì¨ ${emotions['ë‚˜ì¨']}%</div>
                    </div>
                </div>
            `;

            modal.style.display = 'block';
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            document.getElementById('diaryModal').style.display = 'none';
        }

        // í†µê³„ ì—…ë°ì´íŠ¸
        function updateStats() {
            document.getElementById('totalDiaries').textContent = diaries.length;
            
            if (diaries.length === 0) {
                document.getElementById('avgGood').textContent = '0%';
                document.getElementById('avgNormal').textContent = '0%';
                document.getElementById('avgBad').textContent = '0%';
                return;
            }

            const totalGood = diaries.reduce((sum, diary) => sum + diary.emotions['ì¢‹ìŒ'], 0);
            const totalNormal = diaries.reduce((sum, diary) => sum + diary.emotions['í‰ë²”í•¨'], 0);
            const totalBad = diaries.reduce((sum, diary) => sum + diary.emotions['ë‚˜ì¨'], 0);

            document.getElementById('avgGood').textContent = Math.round(totalGood / diaries.length) + '%';
            document.getElementById('avgNormal').textContent = Math.round(totalNormal / diaries.length) + '%';
            document.getElementById('avgBad').textContent = Math.round(totalBad / diaries.length) + '%';
        }

        // ë¡œë”© í‘œì‹œ/ìˆ¨ê¹€
        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        // ì•Œë¦¼ í‘œì‹œ
        function showAlert(message, type) {
            const alert = document.getElementById(type === 'success' ? 'successAlert' : 'errorAlert');
            alert.textContent = message;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // ì•Œë¦¼ ìˆ¨ê¹€
        function hideAlerts() {
            document.getElementById('successAlert').style.display = 'none';
            document.getElementById('errorAlert').style.display = 'none';
        }

        // ë“œë˜ê·¸ ì•¤ ë“œë¡­
        const uploadArea = document.getElementById('uploadArea');
        
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                uploadFile(files[0]);
            }
        });

        // Enter í‚¤ ì²˜ë¦¬
        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                handlePassword();
            }
        }

        // ë°°ê²½ ë³€ê²½ í•¨ìˆ˜
        function changeBackground(type) {
            // ëª¨ë“  ì˜µì…˜ì—ì„œ active í´ë˜ìŠ¤ ì œê±°
            document.querySelectorAll('.bg-option').forEach(option => {
                option.classList.remove('active');
            });
            
            // ì„ íƒëœ ì˜µì…˜ì— active í´ë˜ìŠ¤ ì¶”ê°€
            event.target.closest('.bg-option').classList.add('active');
            
            // ë°°ê²½ ë³€ê²½
            const body = document.body;
            
            switch(type) {
                case 'gradient':
                    body.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
                    body.style.backgroundSize = 'cover';
                    body.style.backgroundPosition = 'center';
                    body.style.backgroundAttachment = 'fixed';
                    body.style.backgroundRepeat = 'no-repeat';
                    break;
                    
                case 'nature':
                    body.style.background = 'linear-gradient(rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)), url("https://images.unsplash.com/photo-1506905925346-21bda4d32df4?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80")';
                    body.style.backgroundSize = 'cover';
                    body.style.backgroundPosition = 'center';
                    body.style.backgroundAttachment = 'fixed';
                    body.style.backgroundRepeat = 'no-repeat';
                    break;
                    
                case 'forest':
                    body.style.background = 'linear-gradient(rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)), url("https://images.unsplash.com/photo-1441974231531-c6227db76b6e?ixlib=rb-4.0.3&auto=format&fit=crop&w=2071&q=80")';
                    body.style.backgroundSize = 'cover';
                    body.style.backgroundPosition = 'center';
                    body.style.backgroundAttachment = 'fixed';
                    body.style.backgroundRepeat = 'no-repeat';
                    break;
                    
                case 'ocean':
                    body.style.background = 'linear-gradient(rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)), url("https://images.unsplash.com/photo-1507525428034-b723cf961d3e?ixlib=rb-4.0.3&auto=format&fit=crop&w=2073&q=80")';
                    body.style.backgroundSize = 'cover';
                    body.style.backgroundPosition = 'center';
                    body.style.backgroundAttachment = 'fixed';
                    body.style.backgroundRepeat = 'no-repeat';
                    break;
                    
                case 'mountain':
                    body.style.background = 'linear-gradient(rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)), url("https://images.unsplash.com/photo-1464822759844-d150baec0134?ixlib=rb-4.0.3&auto=format&fit=crop&w=2070&q=80")';
                    body.style.backgroundSize = 'cover';
                    body.style.backgroundPosition = 'center';
                    body.style.backgroundAttachment = 'fixed';
                    body.style.backgroundRepeat = 'no-repeat';
                    break;
                    
                case 'abstract':
                    body.style.background = 'linear-gradient(rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)), url("https://images.unsplash.com/photo-1557683316-973673baf926?ixlib=rb-4.0.3&auto=format&fit=crop&w=2029&q=80")';
                    body.style.backgroundSize = 'cover';
                    body.style.backgroundPosition = 'center';
                    body.style.backgroundAttachment = 'fixed';
                    body.style.backgroundRepeat = 'no-repeat';
                    break;
                    
                case 'custom':
                    document.getElementById('customBgInput').click();
                    break;
            }
            
            // ì„¤ì • ì €ì¥
            localStorage.setItem('background_type', type);
        }

        // ì»¤ìŠ¤í…€ ë°°ê²½ ì—…ë¡œë“œ
        function uploadCustomBackground(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const body = document.body;
                    body.style.background = `linear-gradient(rgba(102, 126, 234, 0.8), rgba(118, 75, 162, 0.2)), url("${e.target.result}")`;
                    body.style.backgroundSize = 'cover';
                    body.style.backgroundPosition = 'center';
                    body.style.backgroundAttachment = 'fixed';
                    body.style.backgroundRepeat = 'no-repeat';
                    
                    // ì„¤ì • ì €ì¥
                    localStorage.setItem('background_type', 'custom');
                    localStorage.setItem('custom_background', e.target.result);
                };
                reader.readAsDataURL(file);
            }
        }

        // ì €ì¥ëœ ë°°ê²½ ì„¤ì • ë¡œë“œ
        function loadBackgroundSettings() {
            const savedType = localStorage.getItem('background_type');
            if (savedType) {
                changeBackground(savedType);
                
                // ì»¤ìŠ¤í…€ ë°°ê²½ì¸ ê²½ìš°
                if (savedType === 'custom') {
                    const customBg = localStorage.getItem('custom_background');
                    if (customBg) {
                        const body = document.body;
                        body.style.background = `linear-gradient(rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2)), url("${customBg}")`;
                        body.style.backgroundSize = 'cover';
                        body.style.backgroundPosition = 'center';
                        body.style.backgroundAttachment = 'fixed';
                        body.style.backgroundRepeat = 'no-repeat';
                    }
                }
            }
        }

        // í‚¤ì›Œë“œ í´ë¼ìš°ë“œ ê´€ë ¨ ë³€ìˆ˜
        let keywordCloudData = [];

        // ì¼ê¸°ì—ì„œ ì¶”ì¶œëœ í‚¤ì›Œë“œë¥¼ í´ë¼ìš°ë“œì— ì¶”ê°€
        function addKeywordsToCloud(keywords) {
            keywords.forEach(keyword => {
                // ê¸°ì¡´ í‚¤ì›Œë“œê°€ ìˆëŠ”ì§€ í™•ì¸
                const existingKeyword = keywordCloudData.find(k => k.text === keyword);
                if (existingKeyword) {
                    // ê¸°ì¡´ í‚¤ì›Œë“œê°€ ìˆìœ¼ë©´ í¬ê¸° ì¦ê°€
                    existingKeyword.size = Math.min(60, existingKeyword.size + 3);
                } else {
                    // ìƒˆë¡œìš´ í‚¤ì›Œë“œ ì¶”ê°€
                    keywordCloudData.push({
                        text: keyword,
                        size: 15
                    });
                }
            });
            
            // í‚¤ì›Œë“œ í´ë¼ìš°ë“œ ë°ì´í„° ì €ì¥
            localStorage.setItem('keywordCloudData', JSON.stringify(keywordCloudData));
            
            // í´ë¼ìš°ë“œê°€ ì´ë¯¸ í‘œì‹œë˜ì–´ ìˆë‹¤ë©´ ì—…ë°ì´íŠ¸
            const container = document.getElementById('keywordCloud');
            if (container.querySelector('svg')) {
                updateKeywordCloud();
            }
        }

        // í‚¤ì›Œë“œ í´ë¼ìš°ë“œ ì—…ë°ì´íŠ¸
        function updateKeywordCloud() {
            const container = document.getElementById('keywordCloud');
            if (keywordCloudData.length === 0) {
                container.innerHTML = '<p>í‚¤ì›Œë“œ í´ë¼ìš°ë“œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.</p>';
                return;
            }

            const width = container.clientWidth;
            const height = container.clientHeight;

            // ê¸°ì¡´ SVG ì œê±°
            d3.select(container).selectAll('svg').remove();

            const svg = d3.select(container)
                .append('svg')
                .attr('width', width)
                .attr('height', height);

            const g = svg.append('g')
                .attr('transform', `translate(${width/2},${height/2})`);

            const layout = d3.layout.cloud()
                .size([width, height])
                .words(keywordCloudData)
                .padding(5)
                .rotate(() => ~~(Math.random() * 2) * 90)
                .font('Noto Sans KR')
                .fontSize(d => d.size)
                .on('end', draw);

            layout.start();

            function draw(words) {
                g.selectAll('text')
                    .data(words)
                    .enter().append('text')
                    .style('font-size', d => d.size + 'px')
                    .style('font-family', 'Noto Sans KR')
                    .style('fill', () => d3.schemeCategory10[Math.floor(Math.random() * 10)])
                    .attr('text-anchor', 'middle')
                    .attr('transform', d => `translate(${d.x},${d.y})rotate(${d.rotate})`)
                    .text(d => d.text)
                    .classed('keyword-word', true)
                    .on('click', function(d) {
                        showKeywordInfo(d);
                    });
            }
        }

        // í‚¤ì›Œë“œ ì¶”ì¶œ í•¨ìˆ˜
        function extractKeywords(text) {
            // ë¶ˆìš©ì–´ ëª©ë¡ (í•œêµ­ì–´)
            const stopWords = [
                'ì´', 'ê°€', 'ì„', 'ë¥¼', 'ì˜', 'ì—', 'ì—ì„œ', 'ë¡œ', 'ìœ¼ë¡œ', 'ì™€', 'ê³¼', 'ë„', 'ë§Œ', 'ì€', 'ëŠ”', 'ì´', 'ê·¸', 'ì €', 'ìš°ë¦¬', 'ë‚˜', 'ë„ˆ', 'ê·¸ê²ƒ', 'ì´ê²ƒ', 'ì €ê²ƒ',
                'ìˆë‹¤', 'ì—†ë‹¤', 'í•˜ë‹¤', 'ë˜ë‹¤', 'ìˆë‹¤', 'ì—†ë‹¤', 'ê·¸ë¦¬ê³ ', 'í•˜ì§€ë§Œ', 'ë˜ëŠ”', 'ê·¸ë˜ì„œ', 'ê·¸ëŸ°ë°', 'ê·¸ëŸ¬ë‚˜', 'ê·¸ë¦¬ê³ ', 'ë˜í•œ', 'ë˜ëŠ”', 'ê·¸ëŸ¬ë‚˜', 'í•˜ì§€ë§Œ',
                'ì˜¤ëŠ˜', 'ì–´ì œ', 'ë‚´ì¼', 'ì§€ê¸ˆ', 'ì´ì œ', 'ê·¸ë•Œ', 'ì–¸ì œ', 'ì–´ë””', 'ì–´ë–»ê²Œ', 'ì™œ', 'ë¬´ì—‡', 'ëˆ„ê°€', 'ì–´ë–¤', 'ëª‡', 'ì–¼ë§ˆ', 'ì–´ëŠ', 'ë¬´ìŠ¨', 'ì–´ë–¤', 'ì–´ë–»ê²Œ',
                'ì •ë§', 'ë§¤ìš°', 'ë„ˆë¬´', 'ì•„ì£¼', 'ì¡°ê¸ˆ', 'ì•½ê°„', 'ì¡°ê¸ˆ', 'ë§ì´', 'ì ê²Œ', 'í¬ê²Œ', 'ì‘ê²Œ', 'ë¹¨ë¦¬', 'ì²œì²œíˆ', 'ì˜', 'ëª»', 'ì¢‹ë‹¤', 'ë‚˜ì˜ë‹¤', 'í¬ë‹¤', 'ì‘ë‹¤',
                'ìƒˆë¡œìš´', 'ì˜¤ë˜ëœ', 'ì¢‹ì€', 'ë‚˜ìœ', 'í°', 'ì‘ì€', 'ë§ì€', 'ì ì€', 'ë¹ ë¥¸', 'ëŠë¦°', 'ë†’ì€', 'ë‚®ì€', 'ë”°ëœ»í•œ', 'ì°¨ê°€ìš´', 'ë°ì€', 'ì–´ë‘ìš´'
            ];

            // í…ìŠ¤íŠ¸ ì •ë¦¬
            let cleanText = text.replace(/[^\w\sê°€-í£]/g, ' ').toLowerCase();
            
            // ë‹¨ì–´ ë¶„ë¦¬
            let words = cleanText.split(/\s+/).filter(word => 
                word.length > 1 && 
                !stopWords.includes(word) && 
                !/^\d+$/.test(word) && 
                !/^[a-zA-Z]+$/.test(word)
            );

            // ë‹¨ì–´ ë¹ˆë„ ê³„ì‚°
            let wordCount = {};
            words.forEach(word => {
                wordCount[word] = (wordCount[word] || 0) + 1;
            });

            // ë¹ˆë„ìˆœìœ¼ë¡œ ì •ë ¬í•˜ê³  ìƒìœ„ 30ê°œ ì„ íƒ
            let sortedWords = Object.entries(wordCount)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 30)
                .map(([word, count]) => ({
                    text: word,
                    size: Math.max(12, Math.min(60, 12 + count * 3))
                }));

            return sortedWords;
        }

        // í‚¤ì›Œë“œ í´ë¼ìš°ë“œ ìƒì„±
        function generateKeywordCloud() {
            if (diaries.length === 0) {
                showAlert('ë¶„ì„í•  ì¼ê¸°ê°€ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € ì¼ê¸°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            const container = document.getElementById('keywordCloud');
            container.innerHTML = `
                <div class="cloud-loading">
                    <div class="spinner"></div>
                    <p>í‚¤ì›Œë“œë¥¼ ë¶„ì„í•˜ê³  ìˆìŠµë‹ˆë‹¤...</p>
                </div>
            `;

            // ëª¨ë“  ì¼ê¸° ë‚´ìš© í•©ì¹˜ê¸°
            let allText = diaries.map(diary => diary.summary).join(' ');
            
            // í‚¤ì›Œë“œ ì¶”ì¶œ
            keywordCloudData = extractKeywords(allText);

            if (keywordCloudData.length === 0) {
                container.innerHTML = '<p>ë¶„ì„í•  í‚¤ì›Œë“œê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
                return;
            }

            // í´ë¼ìš°ë“œ ìƒì„±
            updateKeywordCloud();
        }

        // í‚¤ì›Œë“œ ì •ë³´ í‘œì‹œ
        function showKeywordInfo(keyword) {
            const count = keywordCloudData.find(k => k.text === keyword.text)?.size || 0;
            const normalizedSize = Math.max(1, Math.round((count - 12) / 3));
            
            showAlert(`"${keyword.text}" - ${normalizedSize}íšŒ ë“±ì¥`, 'success');
        }

        // í‚¤ì›Œë“œ í´ë¼ìš°ë“œ ì´ˆê¸°í™”
        function clearKeywordCloud() {
            const container = document.getElementById('keywordCloud');
            container.innerHTML = '<p>í‚¤ì›Œë“œ í´ë¼ìš°ë“œë¥¼ ìƒì„±í•´ì£¼ì„¸ìš”.</p>';
            keywordCloudData = [];
            localStorage.removeItem('keywordCloudData');
        }

        // í‚¤ì›Œë“œ í´ë¼ìš°ë“œ ë°ì´í„° ë¡œë“œ
        function loadKeywordCloudData() {
            const savedData = localStorage.getItem('keywordCloudData');
            if (savedData) {
                try {
                    keywordCloudData = JSON.parse(savedData);
                } catch (e) {
                    console.error('í‚¤ì›Œë“œ í´ë¼ìš°ë“œ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', e);
                    keywordCloudData = [];
                }
            }
        }

        // ì•± ì´ˆê¸°í™” ì‹œ ë°°ê²½ ì„¤ì • ë¡œë“œ
        document.addEventListener('DOMContentLoaded', function() {
            checkPasswordStatus();
            loadDiaries();
            loadBackgroundSettings();
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.onclick = function(event) {
            const modal = document.getElementById('diaryModal');
            if (event.target === modal) {
                closeModal();
            }
        }
    </script>
</body>
</html>
